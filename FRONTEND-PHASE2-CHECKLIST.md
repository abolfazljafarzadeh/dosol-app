# ูุฑุญูู ฒ ูุฑุงูุช โ ฺฺฉโูุณุช ูุทุน

## โ ูุถุนุช: ููู ููุงุฑุฏ ุจุงุฏ ุชฺฉ ุจุฎูุฑูุฏ ุชุง ูุฑุญูู Done ุจุงุดุฏ

---

## 1๏ธโฃ ุฌุงฺฏุฒู APIูุง (ุงุฌุจุงุฑ)

- [ ] `logPractice()` โ ูุฑุงุฎูุงู `supabase.functions.invoke('log-practice', { body: { minutes, note, idempotency_key } })`
- [ ] `getDashboard()` โ ูุฑุงุฎูุงู `supabase.functions.invoke('get-dashboard')`
- [ ] `getAchievements()` โ ูุฑุงุฎูุงู `supabase.functions.invoke('get-achievements')`
- [ ] `saveTrainingPlan()` โ ูุฑุงุฎูุงู `supabase.functions.invoke('save-training-plan', { body: { days, times, tz } })`
- [ ] **ูฺ ูุญุงุณุจู XP/ุงุณุชุฑฺฉ/ุฑุชุจู/ููุชู/ุชุงุฑุฎ ุฑู ฺฉูุงูุช ุงูุฌุงู ูุดูุฏ** โ ููู ุงุฒ ุณุฑูุฑ

---

## 2๏ธโฃ ฺฉูุฏ Idempotency (ุงูุฒุงู ุฏุฑ ุซุจุช ุชูุฑู)

- [ ] ูุจู ุงุฒ ูุฑุงุฎูุงู `logPractice` ฺฉ `uuid v4` ุชููุฏ ุดูุฏ
- [ ] ฺฉูุฏ ุฏุฑ `body.idempotency_key` ุงุฑุณุงู ุดูุฏ
- [ ] ุฏุฑ ุตูุฑุช Retry (ูุทุน ุดุจฺฉู)ุ **ููุงู ฺฉูุฏ** ุฏูุจุงุฑู ุงุฑุณุงู ุดูุฏ

**ูุซุงู:**
```typescript
import { v4 as uuidv4 } from 'uuid';

const idempotencyKey = uuidv4();
const result = await supabase.functions.invoke('log-practice', {
  body: { minutes: 120, note: 'ุชูุฑู ุนุตุฑ', idempotency_key: idempotencyKey }
});
```

---

## 3๏ธโฃ ูุฏู ุฏุงุฏู ู UI ููุณู ุจุง ูพุงุณุฎโูุง ุฌุฏุฏ

### ุตูุญู ุซุจุช ุชูุฑู (`PracticeLogScreen`)
- [ ] ูพุงุณุฎ `log-practice` ุฑุง ุจุฎูุงู ู ููุงุฏุฑ ุฒุฑ ุฑุง ููุงุด ุจุฏู:
  - `xpGained` โ ุงูุชุงุฒ ฺฉุณุจโุดุฏู
  - `xpToday` โ ุงูุชุงุฒ ุงูุฑูุฒ
  - `streak.current` โ ุงุณุชุฑฺฉ ูุนู
  - `streak.best` โ ุจูุชุฑู ุงุณุชุฑฺฉ
  - `league.xpWeek` โ ุงูุชุงุฒ ููุชฺฏ ูฺฏ
  - `league.rank` โ ุฑุชุจู ุฏุฑ ูฺฏ (ุง `null`)

### ุฏุงุดุจูุฑุฏ (`DashboardScreen`)
- [ ] ููุท ุจุง `getDashboard()` ูพุฑ ุดูุฏุ ุจุฏูู ูุญุงุณุจู ฺฉูุงูุช
- [ ] ููุงุด:
  - `today.minutes` โ ุฏูุงู ุงูุฑูุฒ
  - `today.count` โ ุชุนุฏุงุฏ ุซุจุชโูุง ุงูุฑูุฒ
  - `today.xpToday` โ XP ุงูุฑูุฒ
  - `xpTotal` โ ูุฌููุน XP
  - `streak.current` / `streak.best`
  - `challenge.daysDone` / `challenge.target` / `challenge.isCompleted`
  - `league.id` / `league.xpWeek` / `league.rank`
  - `motivationalMessage` โ ูพุงู ุงูฺฏุฒุด

### ุตูุญู ุฏุณุชุงูุฑุฏูุง (`AchievementsScreen`)
- [ ] ููุท ุจุง `getAchievements()` ูพุฑ ุดูุฏ
- [ ] ููุงุด:
  - `level.current` โ ุณุทุญ ูุนู
  - `level.xpForNextLevel` โ XP ููุฑุฏ ูุงุฒ ุณุทุญ ุจุนุฏ
  - `level.progressPercent` โ ุฏุฑุตุฏ ูพุดุฑูุช
  - `badges[]` โ ูุณุช ูุฏุงูโูุง
  - `league` โ ุงุทูุงุนุงุช ูฺฏ

---

## 4๏ธโฃ ูุฏุฑุช ุฎุทุง (ุซุงุจุช ู ุณุงุฏู)

- [ ] **423** โ ูพุงู: ยซูฺฏ ุจุณุชู ุงุณุชุ ุงูุชุงุฒ ูุงุจู ุงูุฒุงุด ูุณุช.ยป
- [ ] **ฺฉุฏ ุฎุทุง `DAILY_LIMIT`** โ ูพุงู: ยซุญุฏุงฺฉุซุฑ ุฏู ุซุจุช ุง ฒดฐ ุฏููู ุฏุฑ ุฑูุฒ ูุฌุงุฒ ุงุณุช.ยป
- [ ] **ฺฉุฏ ุฎุทุง `MIN_DURATION`** โ ูพุงู: ยซุญุฏุงูู ต ุฏููู ุจุงุฏ ุซุจุช ุดูุฏ.ยป
- [ ] **ฺฉุฏ ุฎุทุง `MISSING_IDEMPOTENCY_KEY`** โ ูพุงู: ยซูุดฺฉู ููุ ูุทูุงู ุฏูุจุงุฑู ุชูุงุด ฺฉูุฏ.ยป
- [ ] **ุณุงุฑ ุฎุทุงูุง** โ ูพุงู ุนููู: ยซุฎุทุง ุดุจฺฉู ุง ุณุฑูุฑุ ูุทูุงู ุฏูุจุงุฑู ุชูุงุด ฺฉูุฏ.ยป

**ูุซุงู:**
```typescript
try {
  const { data, error } = await supabase.functions.invoke('log-practice', { ... });
  if (error) throw error;
  if (!data.ok) {
    if (data.code === 'DAILY_LIMIT') {
      toast.error('ุญุฏุงฺฉุซุฑ ุฏู ุซุจุช ุง ฒดฐ ุฏููู ุฏุฑ ุฑูุฒ ูุฌุงุฒ ุงุณุช.');
    } else if (data.code === 'MIN_DURATION') {
      toast.error('ุญุฏุงูู ต ุฏููู ุจุงุฏ ุซุจุช ุดูุฏ.');
    }
    // ...
  }
} catch (err) {
  if (err.status === 423) {
    toast.error('ูฺฏ ุจุณุชู ุงุณุชุ ุงูุชุงุฒ ูุงุจู ุงูุฒุงุด ูุณุช.');
  } else {
    toast.error('ุฎุทุง ุดุจฺฉู ุง ุณุฑูุฑุ ูุทูุงู ุฏูุจุงุฑู ุชูุงุด ฺฉูุฏ.');
  }
}
```

---

## 5๏ธโฃ UX ฺฉูฺฺฉ ูู ููู

- [ ] ุฏฺฉูู ยซุซุจุช ุชูุฑูยป ุจุนุฏ ุงุฒ ููููุชุ state ุฑุง **ููุฑุงู** ุจุง ูพุงุณุฎ ุณุฑูุฑ ุขูพุฏุช ฺฉูุฏ (ุจุฏูู `refetch` ุงุถุงู)
- [ ] Loader ุงุณุชุงูุฏุงุฑุฏ ุฏุฑ ุญู ุฏุฑุฎูุงุณุช
- [ ] ุฏฺฉูู Retry ุฏุฑ ุตูุฑุช ุฎุทุง ุดุจฺฉู
- [ ] **ุญุฐู Auto-join ูฺฏ ุงุฒ ฺฉูุงูุช** (ูุจูุงู ุงูุฌุงู ุดุฏู โ)

---

## 6๏ธโฃ ุงููุช ู ฺฉูุฏูุง

- [ ] ููู Edge Functionูุง ฺฉุงุฑุจุฑ ุจุง **Anon Key** ู **ูุฏุฑ Authorization** ฺฉุงุฑุจุฑ ุตุฏุง ุดููุฏ
- [ ] ูุงูฺฉุดูโูุง ุงุฏูู (`finalize-weekly-leagues`, `rollover-weekly-challenge`) **ููุท ุงุฒ ุณุฑูุฑ/ฺฉุฑุงู** ุจุง **Service Role** ุตุฏุง ุดููุฏ

**ูุซุงู (ฺฉุงุฑุจุฑ):**
```typescript
const { data } = await supabase.functions.invoke('log-practice', {
  body: { ... },
  headers: {
    Authorization: `Bearer ${session.access_token}`
  }
});
```

---

## 7๏ธโฃ ุชุณุชโูุง ุฏูุฏฺฉุด (QA ุณุฑุน ุฑู ูุฑุงูุช)

- [ ] **ุฏู ุจุงุฑ ุซุจุช ฑฒฐ ุฏููู ุฏุฑ ฺฉ ุฑูุฒ** โ `xpToday=160` (80+80) ู ุฏฺฉูู ุซุจุช ุบุฑูุนุงู ุง ูพุงู ุณูู
- [ ] **ุฑโูพู ููุงู ุฏุฑุฎูุงุณุช ุจุง ููุงู `idempotency_key`** โ ูฺ ุชุบุฑ ุนุฏุฏุ ููุงู ูพุงุณุฎ ูุจู ุจุฑฺฏุฑุฏุฏ
- [ ] **ุนุจูุฑ ุงุฒ ูููโุดุจ** (ุจุง ุชุบุฑ ุณุงุนุช ุฏุณุชฺฏุงู) โ ุงุณุชุฑฺฉ ุฏุฑ ุฏุงุดุจูุฑุฏ ุฏุฑุณุช ูุญุงุณุจู ุดูุฏ
- [ ] **ููุช ูฺฏ ููู ุงุณุช** โ ูพุงู ุฎุทุง `423` ููุงุด ุฏุงุฏู ุดูุฏ

---

## ๐ฏ ุชุนุฑู Done

โ ููู ููุงุฑุฏ ุจุงูุง ุชฺฉ ุฎูุฑุฏู ุจุงุดูุฏ  
โ ูฺ ูุญุงุณุจู XP/ุงุณุชุฑฺฉ/ุฑุชุจู ุฑู ฺฉูุงูุช ูุจุงุดุฏ  
โ ุชุณุชโูุง QA ูพุงุณ ุดุฏู ุจุงุดูุฏ

---

## ๐ ูฺฉุงุช ููู

1. **ูพุงุณุฎ Edge Function ููุงู ูพุงุณุฎ RPC ุงุณุช** โ ููุท ุฑูู ูโฺฉูุฏ
2. **ุชูุงู ููุทู ุฏุฑ RPC** โ Edge Function ููุท authentication + call
3. **Idempotency key** ุฌูู ุฏุงุจูโฺฉูฺฉ ู network retry ุฑุง ูโฺฏุฑุฏ
4. **ฺฉูุงูุช ููุท render** โ ูฺ business logic ูุฏุงุฑุฏ

---

**ุชุงุฑุฎ ุงุฌุงุฏ:** 2025-01-06  
**ูุฑุญูู:** Phase 2 โ Frontend Integration  
**ูุถุนุช:** ๐ก ุฏุฑ ุญุงู ุงูุฌุงู
